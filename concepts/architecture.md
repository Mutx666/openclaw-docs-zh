# 网关架构 (Gateway Architecture)

OpenClaw 采用典型的“网关-节点-客户端”架构，确保多平台接入的稳定性和会话的一致性。

## 核心组件
### 1. 网关 (Gateway Daemon)
- **单一入口**：一个主机只运行一个网关进程。
- **所有权**：网关持有所有通讯平台（WhatsApp, Telegram, Slack 等）的连接会话。
- **API 暴露**：提供类型化的 WebSocket API，支持请求/响应模式和服务器主动推送事件。

### 2. 客户端 (Clients)
- 包括 macOS 桌面应用、CLI 命令行工具、网页后台及自动化脚本。
- 客户端通过 WebSocket 连接到网关，进行配置管理或直接与 Agent 聊天。

### 3. 节点 (Nodes)
- 运行在 macOS, iOS, Android 或无头服务器上的辅助进程。
- 声明 \`role: node\`，并向网关提供特定的硬件能力（如摄像头、位置、屏幕录制）。

## 通信协议
- **传输层**：WebSocket (WS / WSS)。
- **数据格式**：文本帧，内部承载 JSON 数据。
- **握手流程**：连接首帧必须是 \`connect\` 消息，包含身份认证和设备信息。
- **幂等性**：对于有副作用的操作（如发送消息），强制要求 \`idempotencyKey\` 以防止重复执行。

## 安全与配对
- **本地信任**：来自本地回环地址（127.0.0.1）的连接通常可以被自动批准。
- **远程连接**：非本地连接必须通过挑战-响应（Challenge-Response）签名验证，并需要用户在网关端手动通过配对（Pairing）。
- **加密**：推荐使用 Tailscale 或 SSH 隧道进行远程访问，网关也支持原生的 TLS 加密。

## 开发与扩展
- 协议定义基于 **TypeBox**，可自动生成 JSON Schema 和 Swift 模型，确保跨语言调用的类型安全。
