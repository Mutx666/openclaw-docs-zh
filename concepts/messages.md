# 消息处理 (Messages)

本页面介绍了 OpenClaw 如何处理接收消息、会话管理、队列、流式输出以及思维链 (Reasoning) 的可见性。

## 消息流向 (高层视角)
**输入消息** → **路由绑定** → **确定会话 ID** → **进入队列** → **Agent 运行** → **回复输出**。

## 关键机制

### 1. 入站去重 (Dedupe)
当通讯平台由于网络抖动重复推送同一条消息时，网关会通过缓存的消息 ID 进行去重，防止 Agent 多次运行。

### 2. 消息防抖 (Debouncing)
短时间内来自同一发送者的多条连续消息可以合并为一次 Agent 轮次。
- **配置项**：\`messages.inbound.debounceMs\`。
- **注意**：防抖仅适用于文本消息，包含媒体附件的消息会立即处理。

### 3. 会话与上下文
- **主会话**：所有平台的私聊默认共享主会话。
- **群组/频道**：每个群组或频道拥有独立的会话 ID。
- **历史注入**：当进入群组消息时，Agent 会看到之前的上下文（由 \`historyLimit\` 控制数量）。

### 4. 队列与跟进 (Queue)
如果 Agent 正在忙碌，新来的消息会根据策略处理：
- **collect**：收集消息并在当前轮次结束后再回复。
- **interrupt**：强行中断当前运行并响应新消息。
- **steer**：尝试引导当前运行以包含新内容。

### 5. 流式输出与分块 (Streaming)
Agent 可以根据模型生成的进度发送部分回复。
- **配置**：\`agents.defaults.blockStreamingDefault\`。
- **分块**：自动遵守各个平台的字符上限（如 Discord 2000 字），并尽量避免在代码块中间截断。

### 6. 思维链可见性 (Reasoning)
你可以控制是否看到模型的思考过程：
- **/reasoning on|off**：开启或关闭。
- **/reasoning stream**：(仅限 Telegram) 在草稿气泡中实时显示思考过程。
